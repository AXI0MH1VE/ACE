name: Security Audit

on:
  push:
    branches: [master, main]
  pull_request:
  schedule:
    - cron: "0 7 * * 0" # weekly Sunday 07:00 UTC

jobs:
  rust-audit:
    name: Rust cargo audit
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Rust toolchain
        run: rustup update stable && rustup default stable
      - name: Install cargo-audit
        run: cargo install --locked cargo-audit
      - name: Run cargo audit
        run: cargo audit

  python-audit:
    name: Python pip-audit
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Install poetry and pip-audit
        run: pip install "poetry>=1.7" pip-audit
      - name: Export dependencies
        run: poetry export --without-hashes -f requirements.txt -o /tmp/requirements.txt
      - name: Run pip-audit
        run: pip-audit -r /tmp/requirements.txt
